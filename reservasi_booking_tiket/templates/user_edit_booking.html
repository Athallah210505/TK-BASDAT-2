{% extends 'base.html' %}

{% block content %}
{% include 'navbar_pengunjung.html' %}

<div class="container mx-auto px-4 py-8 max-w-5xl mt-20">
    <!-- Header -->
    <h1 class="text-4xl font-bold text-green-500 mb-2">Reservasi Tiket Atraksi</h1>
    <p class="text-gray-600 mb-6">Edit reservasi tiket Anda di Taman Safari</p>

    <!-- Navigation Link -->
    <div class="mb-6">
        <a href="{% url 'show_user_booking' %}" class="inline-flex items-center text-green-600 hover:text-green-800 transition">
            <svg class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
            </svg>
            Kembali ke Daftar Reservasi
        </a>
    </div>

    <!-- Form Reservasi Section -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
        <div class="bg-green-100 p-4 flex items-center">
            <span class="text-green-600 mr-2"><i class="fas fa-ticket-alt"></i></span>
            <h2 class="text-xl font-bold text-gray-800">EDIT RESERVASI</h2>
        </div>
        <div class="p-4 bg-green-50">
            <p class="text-gray-600">Ubah detail reservasi tiket Anda</p>
        </div>
        
        <form method="post" action="{% url 'show_user_booking' %}" class="p-6">
            {% csrf_token %}
            <input type="hidden" name="edit_id" id="editId">
            
            <div class="mb-4">
                <label for="namaAtraksi" class="block text-gray-700 font-medium mb-2">Nama Atraksi:</label>
                <div class="relative">
                    <select id="namaAtraksi" name="nama_atraksi" class="w-full p-3 border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">Pilih Atraksi</option>
                        <option value="pertunjukan_singa_laut" data-lokasi="Arena singa laut" data-kapasitas="10">Pertunjukan Singa Laut</option>
                        <option value="show_burung_bebas" data-lokasi="Arena Burung" data-kapasitas="20">Show Burung Bebas</option>
                        <option value="pertunjukan_gajah" data-lokasi="Arena gajah" data-kapasitas="50">Pertunjukan Gajah</option>
                        <option value="atraksi_harimau" data-lokasi="Arena harimau" data-kapasitas="15">Atraksi Harimau</option>
                        <option value="feeding_show" data-lokasi="Arena tempat makan" data-kapasitas="20">Feeding Show</option>
                        <option value="pertunjukan_lumba_lumba" data-lokasi="Area Akuatik" data-kapasitas="30">Pertunjukan lumba-lumba</option>
                        <option value="show_kuda_laut" data-lokasi="Arena Kuda laut" data-kapasitas="20">Show Kuda Laut</option>
                        <option value="pertunjukan_komodo" data-lokasi="Arena Komodo" data-kapasitas="20">Pertunjukan Komodo</option>
                        <option value="atraksi_penguin" data-lokasi="Arena Penguin" data-kapasitas="20">Atraksi Penguin</option>
                        <option value="show_penguin" data-lokasi="Arena Penguin" data-kapasitas="20">Show Penguin</option>
                        <option value="roller_coaster" data-lokasi="Area Wahana" data-kapasitas="10">Roller Coaster</option>
                        <option value="komedi_putar" data-lokasi="Area Wahana" data-kapasitas="30">Komedi Putar</option>
                        <option value="rumah_hantu" data-lokasi="Area Wahana" data-kapasitas="5">Rumah Hantu</option>
                        <option value="tornado" data-lokasi="Area Wahana" data-kapasitas="15">Tornado</option>
                        <option value="kora_kora" data-lokasi="Area Wahana" data-kapasitas="35">Kora-kora</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <label for="lokasi" class="block text-gray-700 font-medium mb-2">Lokasi:</label>
                <input type="text" id="lokasi" name="lokasi" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" readonly>
            </div>

            <div class="mb-4">
                <label for="jam" class="block text-gray-700 font-medium mb-2">Jam:</label>
                <input type="time" id="jam" name="jam" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>

            <div class="mb-4">
                <label for="tanggal" class="block text-gray-700 font-medium mb-2">Tanggal:</label>
                <input type="date" id="tanggal" name="tanggal" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>

            <div class="mb-6">
                <label for="jumlahTiket" class="block text-gray-700 font-medium mb-2">Jumlah tiket yang ingin dibeli:</label>
                <input type="number" id="jumlahTiket" name="jumlah_tiket" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                <p id="maxTiket" class="text-sm text-gray-500 mt-1">Maksimal 120 tiket per reservasi</p>
            </div>

            <div class="flex justify-end space-x-3">
                <a href="{% url 'show_user_booking' %}" class="px-6 py-2 border border-red-500 text-red-500 rounded-lg hover:bg-red-50 transition">
                    Batal
                </a>
                <button type="submit" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                    Simpan Perubahan
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const namaAtraksiSelect = document.getElementById('namaAtraksi');
        
        // Function to update location and capacity based on selected attraction
        function updateAttractionDetails() {
            // Get the selected option
            const selectedOption = namaAtraksiSelect.options[namaAtraksiSelect.selectedIndex];
            
            // Update lokasi field
            const lokasiValue = selectedOption.getAttribute('data-lokasi');
            if (lokasiValue) {
                document.getElementById('lokasi').value = lokasiValue;
            } else {
                document.getElementById('lokasi').value = '';
            }
            
            // Update max tiket text
            const kapasitasValue = selectedOption.getAttribute('data-kapasitas');
            if (kapasitasValue) {
                document.getElementById('maxTiket').textContent = 'Maksimal ' + kapasitasValue + ' tiket per reservasi';
            } else {
                document.getElementById('maxTiket').textContent = 'Maksimal 120 tiket per reservasi';
            }
        }
        
        // Add event listener for attraction selection change
        namaAtraksiSelect.addEventListener('change', updateAttractionDetails);
        
        // Get the ID from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get('id');
        document.getElementById('editId').value = editId;
        
        // Pre-fill form based on edit ID
        if (editId === '1') {
            // Pertunjukan lumba-lumba
            namaAtraksiSelect.value = 'pertunjukan_lumba_lumba';
            document.getElementById('lokasi').value = 'Area Akuatik';
            document.getElementById('jam').value = '10:00';
            document.getElementById('tanggal').value = '2025-05-12';
            document.getElementById('jumlahTiket').value = '10';
            document.getElementById('maxTiket').textContent = 'Maksimal 30 tiket per reservasi';
        } else if (editId === '2') {
            // Pertunjukan Gajah
            namaAtraksiSelect.value = 'pertunjukan_gajah';
            document.getElementById('lokasi').value = 'Arena gajah';
            document.getElementById('jam').value = '13:00';
            document.getElementById('tanggal').value = '2025-05-15';
            document.getElementById('jumlahTiket').value = '5';
            document.getElementById('maxTiket').textContent = 'Maksimal 50 tiket per reservasi';
        }
        
        // Trigger the update in case the select doesn't initialize properly
        updateAttractionDetails();
    });
</script>
{% endblock %}