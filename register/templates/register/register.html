{% extends "base.html" %}
{% load static %}

{% block meta %}
{% include 'navbar.html' %} 
<div class="h-20"></div> <!-- Spacer adjusted to match navbar height -->
  {{ block.super }}
  <title>Daftar Akun | SIZOPI</title>
{% endblock %}

{% block content %}
<div class="flex items-center justify-center min-h-screen bg-green-50 px-4 pt-16">
  <div class="max-w-lg w-full bg-white rounded-2xl shadow-lg p-8 space-y-6">

    <!-- Role Selection -->
    <div>
      <div class="flex items-center justify-center space-x-4 mb-4">
        <img src="{% static 'image/community.svg' %}" alt="Community Icon" class="h-12 w-12 text-green-500" />
        <h2 class="text-4xl font-bold text-green-500 text-center">Choose Your Role</h2>
      </div>
      <div class="flex justify-center mb-6">
        <select id="roleSelect" class="w-2/3 border border-gray-300 p-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500">
          <option value="">- choose -</option>
          <option value="pengunjung">Pengunjung</option>
          <option value="dokter">Dokter Hewan</option>
          <option value="staff">Staff</option>
        </select>
      </div>
    </div>

    <!-- Forms -->
    <form method="post" action="{% url 'register' %}" class="space-y-4">
      {% csrf_token %}
      <!-- Pengunjung -->
      <div id="form-pengunjung" class="hidden space-y-4">
        {% include 'register_fields/pengunjung.html' %}
      </div>
      <!-- Dokter Hewan -->
      <div id="form-dokter" class="hidden space-y-4">
        {% include 'register_fields/dokter.html' %}
      </div>
      <!-- Staff -->
      <div id="form-staff" class="hidden space-y-4">
        {% include 'register_fields/staff.html' %}
      </div>
      <!-- Submit Button -->
      <button type="submit" id="submitBtn" class="w-full bg-green-500 text-white py-2 rounded btn-shine hover-scale" disabled>Daftar</button>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const roleSelect = document.getElementById('roleSelect');
    const forms = {
      pengunjung: document.getElementById('form-pengunjung'),
      dokter: document.getElementById('form-dokter'),
      staff: document.getElementById('form-staff')
    };
    const submitBtn = document.getElementById('submitBtn');

    roleSelect.addEventListener('change', () => {
      const role = roleSelect.value;
      // hide all
      Object.values(forms).forEach(div => div.classList.add('hidden'));
      submitBtn.disabled = !role;
      submitBtn.textContent = role ? 'Daftar ' + role.charAt(0).toUpperCase() + role.slice(1) : 'Daftar';
      if (forms[role]) {
        forms[role].classList.remove('hidden');
      }
    });

    // Staff ID auto-generate
    const staffRoleSelect = document.getElementById('staffRole');
    const staffIdInput = document.getElementById('staffId');
    staffRoleSelect?.addEventListener('change', () => {
      const prefixMap = {
        'pjh': 'PJH',
        'adm': 'ADM',
        'plp': 'PLP'
      };
      const code = prefixMap[staffRoleSelect.value] || '';
      staffIdInput.value = code + Math.floor(100 + Math.random() * 900);
    });
  });
</script>
{% endblock %}
